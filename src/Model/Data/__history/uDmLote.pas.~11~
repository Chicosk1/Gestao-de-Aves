unit uDmLote;

interface

uses
  System.SysUtils,
  Data.DB,
  FireDAC.Comp.Client,
  FireDAC.DApt,
  uDmInterface,
  dmConexao;

type
  TDmLote = class(TInterfacedObject, ILoteDAO)
  private
    FStoredProc: TFDStoredProc;
  public
    constructor Create;
    destructor Destroy; override;
    class function New: ILoteDAO;
    function ObterTodos: TDataSet;
  end;

implementation

{ TDmLote }

constructor TDmLote.Create;
begin
  FStoredProc := TFDStoredProc.Create(nil);
  FStoredProc.Connection := fdmConexao.GetConexao;
end;

destructor TDmLote.Destroy;
begin
  FStoredProc.Free;
  inherited;
end;

class function TDmLote.New: ILoteDAO;
begin
  Result := Self.Create;
end;

function TDmLote.ObterTodos: TDataSet;
begin
  if FStoredProc.Active then
    FStoredProc.Close;

  FStoredProc.StoredProcName := 'SP_GET_LOTES';
  FStoredProc.Prepare;
  FStoredProc.Open;

  Result := FStoredProc;
end;

end.
